<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#111">
    <title><%= title %></title>
  </head>
  <body>
    <h1><%= title %></h1>
    <form id="auth" action="/api/sendtoken" method="post">
      <fieldset>
        <legend><%= title %></legend>
        <label class="db">
          <span class="label-text">
            Email address
          </span>
          <input type="<%= userFieldType || 'email' %>" name="user" placeholder="Email address" autofocus>
        </label>
        <input type="hidden" name="uid" value="<%= uid %>">
        <input type="hidden" name="to" value="<%= to %>">
        <button type="submit"><%= title %></button>
      </fieldset>
    </form>
    <script>
      (function () {
        var userValue = '';
        try {
          userValue = window.localStorage.userValue || '';
        } catch (err) {
        }
        window.addEventListener('load', function () {
          var authFormEl = document.querySelector('#auth');

          var userEl = authFormEl.querySelector('input[name="user"]');
          if (!userEl.value) {
            userEl.value = userValue;
          }

          authFormEl.addEventListener('submit', function () {
            if (userEl.value) {
              try {
                userValue = window.localStorage.userValue || '';
              } catch (err) {
              }
            }
          });
        });
      })();
    </script>
  </body>
</html>
